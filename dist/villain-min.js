!function(e,a){var i,o=this;i=o.Villain={},i.EventBus=i.EventBus||a.extend({},Backbone.Events),i.Blocks=i.Blocks||{},i.Editor=i.Editor||{};var n=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;a.mixin({isURI:function(t){return n.test(t)},titleize:function(t){return null===t?"":(t=String(t).toLowerCase(),t.replace(/(?:^|\s|-)\S/g,function(t){return t.toUpperCase()}))},classify:function(t){return a.titleize(String(t).replace(/[\W_]/g," ")).replace(/\s/g,"")},classifyList:function(t){return a.map(t,function(t){return a.classify(t)})},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},underscored:function(t){return a.trim(t).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},reverse:function(t){return t.split("").reverse().join("")},flattern:function(t){var e={};return a.each(t,function(i,o){e[a.isArray(t)?i:o]=!0}),e},to_slug:function(t){return t.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}}),e.fn.visible=function(){return this.css("visibility","visible")},e.fn.invisible=function(){return this.css("visibility","hidden")},e.fn.visibilityToggle=function(){return this.css("visibility",function(t,e){return"visible"==e?"hidden":"visible"})},e.fn.caretToEnd=function(){var t,e;return t=document.createRange(),t.selectNodeContents(this[0]),t.collapse(!1),e=window.getSelection(),e.removeAllRanges(),e.addRange(t),this},e.fn.flash=function(t,e){t=t||1e3,e=e||2;var a=Math.floor(t/e);originalColor=this.css("background-color"),this.css("background-color","#ffffdd");for(var i=0;e>i;i++)this.fadeOut(a).fadeIn(a,function(){this.css("background-color","#ffffff")});return this},e.fn.shake=function(t,a,i){return t=t||3,a=a||10,i=i||300,this.each(function(){e(this).css("position","relative");for(var o=1;t>=o;o++)e(this).animate({left:-1*a},i/t/4).animate({left:a},i/t/2).animate({left:0},i/t/4)}),this},function(t){"use strict";var e={init:function(e){var a=t.extend({},t.fn.loadingOverlay.defaults,e),i=t(this).addClass(a.loadingClass),o='<div class="'+a.overlayClass+'"><p class="'+a.spinnerClass+'"><span class="'+a.iconClass+'"></span><span class="'+a.textClass+'">'+a.loadingText+"</span></p></div>";return i.data("loading-overlay")||i.prepend(t(o)).data("loading-overlay",!0),i},remove:function(e){var a=t.extend({},t.fn.loadingOverlay.defaults,e),i=t(this).data("loading-overlay",!1);return i.find("."+a.overlayClass).detach(),i.hasClass(a.loadingClass)?i.removeClass(a.loadingClass):i.find("."+a.loadingClass).removeClass(a.loadingClass),i},exposeMethods:function(){return e}};t.fn.loadingOverlay=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.loadingOverlay"):e.init.apply(this,arguments)},t.fn.loadingOverlay.defaults={loadingClass:"loading",overlayClass:"loading-overlay",spinnerClass:"loading-spinner",iconClass:"loading-icon fa fa-circle-o-notch fa-spin",textClass:"loading-text",loadingText:""}}(jQuery),i.Plus=Backbone.View.extend({tagName:"div",className:"villain-add-block villain-droppable",blockSelectionTemplate:a.template('<div class="villain-block-selection"><%= content %></div>'),events:{"click .villain-add-block-button":"onClickAddBlock","click .villain-block-button":"onClickBlockButton"},initialize:function(t){this.store=t,this.$el.attr("data-blockstore",t),this.$el.attr("id",a.uniqueId("villain-plus-")),this.render()},render:function(){return this.$el.append('<button class="villain-add-block-button">+</button>'),this},onClickBlockButton:function(t){console.log(t),t.preventDefault(),$button=e(t.currentTarget),blockType=$button.data("type"),blockStore=this.store,BlockClass=i.BlockRegistry.getBlockClassByType(blockType),block=new BlockClass(!1,blockStore),block.$el.insertAfter($button.parent().parent()),block.$el.after(block.renderPlus().$el),block.hasTextBlock()&&block.setCaret(),block.scrollTo(),$button.parent().prev().show(),$button.parent().remove()},onClickAddBlock:function(t){t.preventDefault(),$addBlockButton=e(t.currentTarget),$addBlockButton.hide(),blockId=$addBlockButton.parent().data("after-block-id"),blockSelection=this.blockSelectionTemplate({content:this.getButtons(blockId)}),$addBlockButton.parent().append(blockSelection)},getButtons:function(t){html="";for(var e in i.BlockRegistry.Map)b=i.BlockRegistry.getBlockClassByType(e),b.hasOwnProperty("getButton")&&(html+=b.getButton(t));return html}}),i.BlockStore=[],i.BlockStore.count=1,i.BlockStore.getId=function(){return id=i.BlockStore.count,i.BlockStore.count++,id},i.BlockStore.getBlockById=function(t,e){return block=a.find(i.BlockStore[t],function(t){return t.id==e}),block&&block.hasOwnProperty("object")?block.object:!1},i.BlockStore.add=function(t,e,a){i.BlockStore[t].push({id:e,object:a})},i.BlockStore.del=function(t,e){console.log(i.BlockStore[t]),i.BlockStore[t]=a.filter(i.BlockStore[t],function(t){return t.id!==e})},i.BlockStore.delStore=function(t){a.each(i.BlockStore[t],function(t){t.object.destroy()}),i.BlockStore[t]=[]},i.BlockStore.create=function(t){i.BlockStore[t]=[]},i.Block=Backbone.View.extend({tagName:"div",className:"villain-block-wrapper",type:"base",template:a.template("base"),store:"main",wrapperTemplate:a.template(['<div class="villain-block-inner"><%= content %><%= actions %></div>'].join("\n")),actionsTemplate:a.template(['<div class="villain-actions">','  <div class="villain-action-button villain-action-button-setup">','    <i class="fa fa-cogs"></i>',"  </div>",'  <div class="villain-action-button villain-action-button-del">','    <i class="fa fa-trash"></i>',"  </div>",'  <div class="villain-action-button villain-action-button-move" draggable="true">','    <i class="fa fa-arrows-alt"></i>',"  </div>","</div>"].join("\n")),setupTemplate:a.template('<div class="villain-setup-block" />'),events:{"dragstart .villain-action-button-move":"onDragStart","click .villain-action-button-del":"onClickDelete","mouseover .villain-block-inner":"onMouseOver","mouseout .villain-block-inner":"onMouseOut","paste .villain-text-block":"onPaste","mouseup .villain-text-block":"onMouseUp","click .villain-text-block":"onClick","click .villain-action-button-setup":"onSetupClick"},onClick:function(){var t=this.getSelectedText();""===t&&i.EventBus.trigger("formatpopup:hide")},onSetupClick:function(){$button=this.$(".villain-action-button-setup"),$button.hasClass("active")?($button.removeClass("active"),this.hideSetup()):($button.addClass("active"),this.showSetup())},onMouseUp:function(){var t=this.getSelectedText();""!==t?i.EventBus.trigger("formatpopup:show",this):i.EventBus.trigger("formatpopup:hide")},getSelectedText:function(){var t="";return window.getSelection?t=window.getSelection():document.getSelection?t=document.getSelection():document.selection&&(t=document.selection.createRange().text),t.toString()},deleteBlock:function(){i.BlockStore.del(this.store,this.dataId),this.destroy()},loading:function(){this.$el.loadingOverlay()},done:function(){this.$el.loadingOverlay("remove")},destroy:function(){this.$el.next(".villain-add-block").remove(),this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},onClickDelete:function(t){this.deleteBlock(),t.stopPropagation()},onDragStart:function(t){console.log(t.currentTarget),t.originalEvent.dataTransfer.setDragImage(this.$el.get(0),this.$el.width(),this.$el.height()),t.originalEvent.dataTransfer.setData("Text",this.dataId),t.stopPropagation()},onMouseOver:function(){this.$inner.addClass("hover"),this.$inner.children(".villain-actions").visible()},onMouseOut:function(){this.$inner.removeClass("hover"),this.$inner.children(".villain-actions").invisible()},onPaste:function(t){var a=!1;if(t&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.getData){var o="",n=t.originalEvent.clipboardData.types;if(e.isArray(n))for(var l=0;l<n.length;l++)o+=n[l]+";";else o=n;if(/text\/html/.test(o)?clipboardHTML=t.originalEvent.clipboardData.getData("text/html"):/text\/rtf/.test(o)&&i.browser.safari?clipboardHTML=t.originalEvent.clipboardData.getData("text/rtf"):/text\/plain/.test(o)&&!i.browser.mozilla&&(clipboardHTML=t.originalEvent.clipboardData.getData("text/plain").replace(/\n/g,"<br/>")),""!==this.clipboardHTML?a=!0:this.clipboardHTML=null,a)return cleanHtml=i.Editor.processPaste(clipboardHTML),t.stopPropagation(),t.preventDefault(),console.log(cleanHtml),i.Editor.pasteHtmlAtCaret(cleanHtml),!1}},getIdFromBlockStore:function(){return i.BlockStore.getId()},initialize:function(t,e){console.log("BaseBlock.initialize() -- "+this.type),this.data=t||null,this.dataId=this.getIdFromBlockStore(),this.$el.attr("data-block-id",this.dataId),this.$el.attr("data-block-type",this.type),this.$el.attr("id","villain-block-"+this.dataId),e&&(this.store=e),this.$el.attr("data-blockstore",this.store),this.id="villain-block-"+this.dataId,this.addToBlockStore(e),this.render()},hasTextBlock:function(){return 0===this.$(".villain-text-block").length?!1:!0},setCaret:function(){var t,e;t=document.createRange(),t.selectNodeContents(this.getTextBlock()[0]),t.collapse(!1),e=window.getSelection(),e.removeAllRanges(),e.addRange(t)},scrollTo:function(){e("html, body").animate({scrollTop:this.$el.offset().top-75},300,"linear")},flash:function(){},getJSON:function(){return console.log("getJSON/"+this.type+": No parser found."),[]},addToBlockStore:function(t){i.BlockStore.add(t?t:"main",this.dataId,this)},setData:function(t){this.data=t},getData:function(){return this.data},hasData:function(){return this.data?!0:!1},refreshBlock:function(){return html=this.renderEditorHtml(),this.el.innerHTML=html,this.$inner=this.$(".villain-block-inner"),this},render:function(){return console.log("BASEBLOCK: render"),this.data?(console.log("BASEBLOCK: call renderEditorHtml"),html=this.renderEditorHtml()):(console.log("BASEBLOCK: call renderEmpty"),html=this.renderEmpty()),this.el.innerHTML=html,this.$inner=this.$(".villain-block-inner"),this.$content=this.$(".villain-content"),this.setup?(this.$inner.prepend(this.setupTemplate()),this.$setup=this.$(".villain-setup-block"),this.$(".villain-action-button-setup").show(),this.setup()):this.$(".villain-action-button-setup").hide(),this},getTextBlock:function(){return a.isUndefined(this.textBlock)&&(this.textBlock=this.$(".villain-text-block")),this.textBlock},clearInsertedStyles:function(t){var e=t.target;e.removeAttribute("style")},renderEditorHtml:function(){console.log("BASEBLOCK: renderEditorHtml")},renderEmpty:function(){console.log("BASEBLOCK: renderEmpty")},renderPlus:function(){return addblock=new i.Plus(this.store)},showSetup:function(){this.$content.hide(),$button=this.$(".villain-action-button-setup"),$button.addClass("active"),this.$setup.show()},hideSetup:function(){this.$setup.hide(),$button=this.$(".villain-action-button-setup"),$button.removeClass("active"),this.$content.show()}}),i.Blocks.Text=i.Block.extend({type:"text",template:a.template('<div class="villain-text-block villain-content" contenteditable="true"><%= content %></div>'),renderEditorHtml:function(){return blockTemplate=this.template({content:i.toHTML(this.data.text)}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},renderEmpty:function(){return blockTemplate=this.template({content:""}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},getJSON:function(){return textNode=i.toMD(this.getTextBlock().html()),json={type:this.type,data:{text:textNode}}},getHTML:function(){return textNode=this.getTextBlock().html(),markdown.toHTML(textNode)}},{getButton:function(e){return blockType="text",(t=a.template(['<button class="villain-block-button" data-type="<%= type %>" data-after-block-id="<%= id %>">','<i class="fa fa-paragraph"></i>',"</button>"].join("\n")))({id:e,type:blockType})}}),i.Blocks.Divider=i.Block.extend({type:"divider",template:a.template('<div class="villain-divider-block villain-content"><hr></div>'),renderEditorHtml:function(){return blockTemplate=this.template(),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},renderEmpty:function(){return blockTemplate=this.template(),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},getJSON:function(){return json={type:this.type,data:{text:"--------------------"}}},getHTML:function(){return"<hr>"}},{getButton:function(e){return blockType="divider",(t=a.template(['<button class="villain-block-button" data-type="<%= type %>" data-after-block-id="<%= id %>">','<i class="fa fa-minus"></i>',"</button>"].join("\n")))({id:e,type:blockType})}}),i.Blocks.Header=i.Block.extend({type:"header",template:a.template(['<div class="villain-text-block villain-text-block-header villain-content" contenteditable="true">',"<%= content %>","</div>"].join("\n")),renderEditorHtml:function(){return blockTemplate=this.template({content:this.data.text}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},renderEmpty:function(){return blockTemplate=this.template({content:""}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},getJSON:function(){return textNode=i.toMD(this.getTextBlock().html()).trim(),json={type:this.type,data:{text:textNode}},console.log("header:getjson > "+textNode),json},getHTML:function(){return textNode=this.getTextBlock().html(),"<h3>"+markdown.toHTML(textNode)+"</h3>"}},{getButton:function(e){return blockType="header",(t=a.template(['<button class="villain-block-button" data-type="<%= type %>" data-after-block-id="<%= id %>">','<i class="fa fa-header"></i>',"</button>"].join("\n")))({id:e,type:blockType})}}),i.Blocks.List=i.Block.extend({type:"list",template:a.template(['<div class="villain-text-block villain-text-block-list villain-content" contenteditable="true">',"<ul><li><%= content %></li></ul>","</div>"].join("\n")),renderEditorHtml:function(){return blockTemplate=this.template({content:this.data.text}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},renderEmpty:function(){return blockTemplate=this.template({content:"Liste"}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},getJSON:function(){return textNode=this.getTextBlock().html().replace(/<\/li>/gm,"\n").replace(/<\/?[^>]+(>|$)/g,"").replace(/^(.+)$/gm," - $1"),json={type:this.type,data:{text:textNode}}},getHTML:function(){return textNode=this.getTextBlock().html(),"<h3>"+markdown.toHTML(textNode)+"</h3>"},toMarkdown:function(t){return t.replace(/<\/li>/gm,"\n").replace(/<\/?[^>]+(>|$)/g,"").replace(/^(.+)$/gm," - $1")}},{getButton:function(e){return blockType="list",(t=a.template(['<button class="villain-block-button" ','        data-type="<%= type %>" ','        data-after-block-id="<%= id %>"',">",'   <i class="fa fa-list-ul"></i>',"</button>"].join("\n")))({id:e,type:blockType})}}),i.Blocks.Image=i.Block.extend({type:"image",template:a.template('<div class="villain-image-block villain-content"><img class="img-responsive" src="<%= url %>" /></div>'),events:{"drop .villain-image-dropper i":"onDropImage","dragenter .villain-image-dropper i":"onDragEnter","dragleave .villain-image-dropper i":"onDragLeave","dragover .villain-image-dropper i":"onDragOver","click .villain-image-dropper-upload":"onUploadClickAfterDrop"},initialize:function(t,e){i.Block.prototype.initialize.apply(this,[t,e]),a.extend(this.events,i.Block.prototype.events)},onUploadClickAfterDrop:function(){this.loading();var t=[this.dataId,(new Date).getTime(),"raw"].join("-");if(img=this.$setup.find(".villain-image-dropper img"),console.log(img),!this.file)return this.done(),!1;var i=new FormData;i.append("name",this.file.name),i.append("file",this.file),i.append("uid",t),that=this,e.ajax({type:"post",url:"last-opp/bilde/",data:i,cache:!1,contentType:!1,processData:!1,xhr:function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",that.progressHandlingFunction,!1),t},dataType:"json"}).done(e.proxy(function(i){if(console.log(i),"200"==i.status&&(this.$setup.append('<div class="villain-message success">Bildet er lastet opp</div>'),this.$setup.find(".villain-image-dropper-upload").remove(),this.$setup.find(".villain-image-dropper").remove(),i.hasOwnProperty("image")&&(imageData=i.image,$image=e('<img src="'+imageData.src+'" />'),this.$setup.append($image),json={url:imageData.src},this.setData(json)),i.hasOwnProperty("uid")&&(t=i.uid),i.hasOwnProperty("form"))){var o="";inputTemplate=a.template(["<label><%= label %></label>",'<input type="<%= type %>" ','       value="<%= value %>" ','       name="<%= name %>"',"/>"].join("\n"));for(var n=0;n<i.form.fields.length;n++)field=i.form.fields[n],o+=inputTemplate({label:field.label,type:field.type,value:field.value,name:field.name});formTemplate=a.template(['<form method="<%= method %>" ','      action="<%= action %>" ','      class="villain-form" ','      name="<%= name %>"',">","<%= inputs %>","</form>"].join("\n")),form=formTemplate({method:i.form.method,action:i.form.action,name:i.form.name,inputs:o}),$form=e(form),$submitButton=e('<input type="submit" name="'+i.form.name+'-submit" value="Lagre" />'),$submitButton.on("click",function(a){a.preventDefault(),serializedForm=$form.serialize(),imagedata=new FormData,imagedata.append("form",serializedForm),imagedata.append("uid",t),e.ajax({type:"post",url:i.form.action,data:imagedata,cache:!1,contentType:!1,processData:!1,dataType:"json"}).done(e.proxy(function(t){200==t.status&&(json=that.getData(),json.caption="",json.title="",that.setData(json),that.refreshBlock(),console.log(t))},this))}),$form.append($submitButton),this.$setup.append($form)}},this)).fail(e.proxy(function(){alert("Feil fra server under opplasting.")},this)).always(e.proxy(function(){})),this.done()},progressHandlingFunction:function(t){t.lengthComputable},onDragEnter:function(t){this.$(".villain-image-dropper i").addClass("drop-hover"),t.preventDefault()},onDragLeave:function(t){this.$(".villain-image-dropper i").removeClass("drop-hover"),t.preventDefault()},onDragOver:function(t){t.preventDefault()},onDropImage:function(t){t.preventDefault(),this.$(".villain-image-dropper i").removeClass("drop-hover"),dataTransfer=t.originalEvent.dataTransfer;var a=dataTransfer.files[0],i="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;/image/.test(a.type)&&(this.$(".villain-image-dropper").html(e("<img>",{src:i.createObjectURL(a)})),$form=e(['<form enctype="multipart/form-data" ','encoding="multipart/form-data" action="upload/image" ','method="post" id="villain-upload-form-'+this.dataId+'">','<input id="villain-upload-file-'+this.dataId+'" ','type="file" ','name="villain-upload-file-'+this.dataId+'" ','accept="image/*">',"</form>"].join("\n")),this.$setup.append("<hr>"),this.$setup.append('<button class="villain-image-dropper-upload">Last opp og lagre</button>'),this.file=a)},renderEditorHtml:function(){return blockTemplate=this.template({url:this.data.url}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},renderEmpty:function(){return blockTemplate=this.template({url:"http://placehold.it/1150x400"}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},getJSON:function(){return url=this.$("img").attr("src"),json={type:this.type,data:{url:url}}},getHTML:function(){return url=this.$("img").attr("src"),this.template({url:url})},setup:function(){this.hasData()||(this.$(".villain-image-block").hide(),$imageDropper=e(['<div class="villain-image-dropper"><i class="fa fa-image"></i>',"<div>Dra bildet du vil laste opp hit</div>","<div><hr></div>","<div>",'<button class="villain-image-browse-button">Hent bilde fra server</button>',"</div>","</div>"].join("\n")),$imageDropper.find(".villain-image-browse-button").on("click",e.proxy(this.onImageBrowseButton,this)),this.$setup.append($imageDropper),this.$setup.show())},onImageBrowseButton:function(t){t.preventDefault(),this.loading(),e.ajax({type:"get",url:"browse/",cache:!1,contentType:!1,processData:!1,dataType:"json"}).done(e.proxy(function(t){if(200!=t.status)return!1;if(!t.hasOwnProperty("images"))return!1;$images=e("<div />");for(var a=0;a<t.images.length;a++)img=t.images[a],$images.append('<img src="'+img.thumb+'" data-large="'+img.src+'" />');$images.on("click","img",e.proxy(function(t){this.setData({url:e(t.target).data("large")}),this.refreshBlock()},this)),this.$setup.html(""),this.$setup.append('<div class="villain-message success">Klikk på bildet du vil sette inn</div>'),this.$setup.append($images),this.done()},this))},onUploadImagesButton:function(t){var e=t.target.files,a="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;fileList=[];for(var i=0;i<e.length;i++){var o=e[i];fileList.push(['<div class="three">','<div class="center-cropped" style="background-image: url(',a.createObjectURL(o),');"></div>',"</div>"].join("\n"))}listHTML='<div style="margin-top: 10px;" class="wrapper"><div class="row">';for(var n=0;n<fileList.length;n++)listHTML+=n&&n%4===0?'</div><div style="margin-top: 15px" class="row">'+fileList[n]:fileList[n];listHTML+="</div></div>",this.$setup.append(listHTML)}},{getButton:function(e){return blockType="image",(t=a.template(['<button class="villain-block-button" data-type="<%= type %>" data-after-block-id="<%= id %>">','<i class="fa fa-file-image-o"></i>',"</button>"].join("\n")))({id:e,type:blockType})}}),i.Blocks.Video=i.Block.extend({type:"video",providers:{vimeo:{regex:/(?:http[s]?:\/\/)?(?:www.)?vimeo.com\/(.+)/,html:['<iframe src="{{protocol}}//player.vimeo.com/video/{{remote_id}}?title=0&byline=0" ','width="580" height="320" frameborder="0"></iframe>'].join("\n")},youtube:{regex:/(?:http[s]?:\/\/)?(?:www.)?(?:(?:youtube.com\/watch\?(?:.*)(?:v=))|(?:youtu.be\/))([^&].+)/,html:['<iframe src="{{protocol}}//www.youtube.com/embed/{{remote_id}}" ','width="580" height="320" frameborder="0" allowfullscreen></iframe>'].join("\n")}},template:a.template('<div class="villain-video-block villain-content"><%= content =></div>'),events:{"click .villain-setup-block button":"onClick"},onClick:function(t){if(t.preventDefault(),videoUrl=this.$(".villain-video-setup-url").val(),a.isURI(videoUrl)){var e,i;if(a.each(this.providers,function(t,o){e=t.regex.exec(videoUrl),null===e||a.isUndefined(e[1])||(i={source:o,remote_id:e[1]},this.setData(i))},this),this.providers.hasOwnProperty(i.source)){var o=this.providers[i.source].html.replace("{{protocol}}",window.location.protocol).replace("{{remote_id}}",i.remote_id).replace("{{width}}","100%");this.$content.html(o),this.hideSetup()}}},initialize:function(t,e){i.Block.prototype.initialize.apply(this,[t,e]),a.extend(this.events,i.Block.prototype.events)},renderEditorHtml:function(){return blockTemplate=this.template({content:""}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},renderEmpty:function(){return blockTemplate=this.template({content:""}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),wrapperTemplate},getJSON:function(){return url=this.$("img").attr("src"),json={type:this.type,data:{url:url}}},getHTML:function(){return url=this.$("img").attr("src"),this.template({url:url})},setup:function(){this.hasData()||(this.$(".villain-video-block").hide(),videoSetup=e(['<div class="villain-video-setup-icon">','<i class="fa fa-video-camera"></i>',"<div>Lim inn link til youtube eller vimeo, f.eks http://www.youtube.com/watch?v=jlbunmCbTBA</div>","</div>",'<div class="villain-video-setup-input-wrapper">','<input type="text" name="villain-video-setup-url" class="villain-video-setup-url" />',"</div>","<div><hr></div>",'<div style="text-align: center;"><button>Hent video</button></div>'].join("\n")),this.$setup.append(videoSetup),this.$setup.show())}},{getButton:function(e){return blockType="video",(t=a.template(['<button class="villain-block-button" data-type="<%= type %>" data-after-block-id="<%= id %>">','<i class="fa fa-video-camera"></i>',"</button>"].join("\n")))({id:e,type:blockType})}}),i.Blocks.Columns=i.Block.extend({type:"columns",template:a.template('<div class="row"></div>'),columnTemplate:a.template('<div class="<%= columnClass %>"></div>'),events:{'keyup input[name="villain-columns-number"]':"_updateColumnCount","click button.villain-columns-apply":"_applyColumnCount"},initialize:function(t,e){i.Block.prototype.initialize.apply(this,[t,e]),a.extend(this.events,i.Block.prototype.events)},deleteBlock:function(){i.BlockStore.hasOwnProperty(this.store)&&i.BlockStore.delStore(this.store),i.BlockStore.del("main",this.dataId),this.destroy()},renderBlock:function(t){return t.$parent?void(t.$parent.attr("id")===this.$el.attr("id")&&this.$el.append(t.el)):!1},render:function(){return console.log("render in COLUMNS"),i.BlockStore.create(this.id),this.store=this.id,this.$el.attr("data-blockstore",this.store),blockTemplate=this.template({content:this.data}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),this.el.innerHTML=wrapperTemplate,this.$inner=this.$(".villain-block-inner"),this.data?(console.log("call renderEditorHtml"),this.renderEditorHtml()):(console.log("call renderEmpty"),this.renderEmpty()),this.setup&&(this.$inner.prepend(this.setupTemplate()),this.$setup=this.$(".villain-setup-block"),this.setup()),this},renderEditorHtml:function(){return this.parseRow(),blockTemplate=this.template({content:this.data}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),this},renderEmpty:function(){return blockTemplate=this.template({content:this.data}),actionsTemplate=this.actionsTemplate(),wrapperTemplate=this.wrapperTemplate({content:blockTemplate,actions:actionsTemplate}),console.log(wrapperTemplate),this},getRow:function(){return this.$row?this.$row:(this.$row=this.$(".row"),this.$row)},getColumns:function(t){return this.getRow().children(t)},getColumn:function(t){return this.getRow().children(":eq("+t+")")},parseRow:function(){$row=this.getRow();for(var t=0;t<=this.data.length-1;t++){columnClass=this.data[t].class,columnData=this.data[t].data,$column=e('<div class="'+columnClass+'"></div>'),$row.append($column),$column=this.getColumn(t),addblock=new i.Plus(this.store),$column.append(addblock.$el);for(var a=0;a<columnData.length;a++)(BlockClass=i.BlockRegistry.getBlockClassByType(columnData[a].type))!==!1&&(console.log("parseColumn: "+columnData[a].data),block=new BlockClass(columnData[a].data,this.store),$column.append(block.$el),addblock=new i.Plus(this.store),$column.append(addblock.$el))}},getJSON:function(){var t={type:this.type,data:[]};return this.getColumns().each(function(){var a=[];e(this).children(".villain-block-wrapper").each(function(){var t=i.BlockStore.getBlockById(e(this).attr("data-blockstore"),e(this).attr("data-block-id"));a.push(t.getJSON())}),t.data.push({"class":e(this).attr("class"),data:a})}),t},setup:function(){this.hasData()||(this.getRow().hide(),this.$setup.append(['<label for="villain-columns-number">Antall kolonner</label>','<input type="text" class="villain-columns-number" name="villain-columns-number" />'].join("\n")),this.$setup.show(),this.$(".villain-columns-number").attr("autofocus","autofocus"))},_updateColumnCount:function(t){var a=e(t.target).val();console.log(a),this.$(".villain-column-widths").remove(),columnCountWrapper=e('<div class="villain-column-widths" />');for(var i=1;i<parseInt(a)+1;i++)columnCountWrapper.append(['<label for="villain-column-width-'+i+'">Kolonne '+i+" klassenavn (one, two, three ...)</label>",'<input type="text" name="villain-column-width-'+i+'" class="villain-column-width" />'].join("\n"));columnCountWrapper.append('<button class="villain-columns-apply">Sett opp kolonner</button>'),this.$setup.append(columnCountWrapper)},_applyColumnCount:function(){columnCount=this.$('input[name="villain-columns-number"]').val();for(var t=1;t<parseInt(columnCount)+1;t++)columnClass=this.$('input[name="villain-column-width-'+t+'"]').val(),this.getRow().append(this.columnTemplate({columnClass:columnClass})),addblock=new i.Plus(this.store),this.getColumn(t-1).append(addblock.$el),console.log(this.getColumn(t));this.$setup.hide(),this.getRow().show()},renderPlus:function(){return addblock=new i.Plus("main")}},{getButton:function(e){return blockType="columns",(t=a.template(['<button class="villain-block-button" data-type="<%= type %>" data-after-block-id="<%= id %>">','<i class="fa fa-columns"></i>',"</button>"].join("\n")))({id:e,type:blockType})}});i.Editor=Backbone.View.extend({el:"#villain",textArea:"#id_body",data:{},blocks:{},events:{"submit form":"clickSubmit","dragover .villain-droppable":"onDragOverDroppable","dragenter .villain-droppable":"onDragEnterDroppable","dragleave .villain-droppable":"onDragLeaveDroppable","drop .villain-droppable":"onDropDroppable","drop .villain-text-block":"onDropTextblock"},getJSON:function(){var t=[];return this.$(".villain-block-wrapper").each(function(){(block=i.BlockStore.getBlockById("main",e(this).data("block-id")))!==!1&&(console.log("block-type: "+block.type+" block-id: "+block.id),blockJson=block.getJSON(),t.push(blockJson))}),console.log(JSON.stringify(JSON.parse(JSON.stringify(t)),null,2)),JSON.stringify(t)},onDragEnterDroppable:function(t){e(".villain-add-block-button",t.currentTarget).addClass("drop-hover"),t.preventDefault(),t.stopPropagation()},onDragLeaveDroppable:function(t){e(".villain-add-block-button",t.currentTarget).removeClass("drop-hover"),t.preventDefault(),t.stopPropagation()},onDragOverDroppable:function(t){console.log("curr: "+e(t.currentTarget).attr("class")),t.preventDefault(),t.stopPropagation()},onDropDroppable:function(t){return console.log("dropped"),target=t.currentTarget,e(target).hasClass("villain-droppable")!==!0?(t.preventDefault(),t.stopPropagation(),!1):(e(".villain-add-block-button",target).removeClass("drop-hover"),sourceId=t.originalEvent.dataTransfer.getData("text/plain"),$source=e("[data-block-id="+sourceId+"]"),$sourceAdd=$source.next(),$source.detach(),$sourceAdd.detach(),$source.insertAfter(e(target)),oldBlockStore=$source.attr("data-blockstore"),newBlockStore=e(target).attr("data-blockstore"),block=i.BlockStore.getBlockById(oldBlockStore,sourceId),block.store=newBlockStore,i.BlockStore.del(oldBlockStore,sourceId),i.BlockStore.add(newBlockStore,sourceId,block),$source.attr("data-blockstore",newBlockStore),$sourceAdd.insertAfter($source),$sourceAdd.attr("data-blockstore",newBlockStore),void console.log($sourceAdd))},onDropTextblock:function(t){return $target=e(t.currentTarget).closest(".villain-block-wrapper").shake(),t.preventDefault(),t.stopPropagation(),!1},clickSubmit:function(t){i.EventBus.trigger("posts:submit",t),form=this.checkForm(),form.valid===!1&&t.preventDefault(),window.onbeforeunload=e.noop()
},checkForm:function(){var t={valid:!0,errors:[]};return""===$titleEl.val()&&(t.errors.push("Overskrift kan ikke være blank."),t.valid=!1,$titleEl.parent().parent().addClass("error"),$titleEl.parent().parent().append('<span class="help-inline"><strong><i class="icon-hand-up"></i> Feltet er påkrevet.</strong></span>'),e("html, body").animate({scrollTop:0},5)),t},markDirty:function(){this.isDirty=!0},initialize:function(){that=this,this.isDirty=!1,this.$el=e(this.el),this.$textArea=e(this.textArea),this.$textArea.hide();try{this.data=JSON.parse(this.$textArea.val())}catch(t){console.log("editor/init: No usable JSON found in textarea."),this.data=null}i.BlockStore.create("main"),this.render()},render:function(){if(addblock=new i.Plus("main"),this.$el.append(addblock.$el),formatPopUp=new i.FormatPopUp,this.$el.append(formatPopUp.$el),!this.data)return!1;for(var t=0;t<=this.data.length-1;t++)blockJson=this.data[t],(BlockClass=i.BlockRegistry.getBlockClassByType(blockJson.type))!==!1?(block=new BlockClass(blockJson.data),this.$el.append(block.$el),this.$el.append(block.renderPlus().$el)):console.error("Villain: No class found for type: "+blockJson.type)}}),i.FormatPopUp=Backbone.View.extend({tagName:"div",className:"villain-format-popup",events:{"click .villain-format-bold":"onClickBold","click .villain-format-italic":"onClickItalic","click .villain-format-link":"onClickLink","click .villain-format-unlink":"onClickUnlink"},onClickBold:function(){document.execCommand("bold",!1,!1),this.activateButton(".villain-format-bold")},onClickItalic:function(){document.execCommand("italic",!1,!1),this.activateButton(".villain-format-italic")},onClickLink:function(){var t=prompt("Sett inn link:"),e=/((ftp|http|https):\/\/.)|mailto(?=\:[-\.\w]+@)/;t&&t.length>0&&(e.test(t)||(t="http://"+t),document.execCommand("CreateLink",!1,t)),this.activateButton(".villain-format-link")},onClickUnlink:function(){document.execCommand("unlink",!1,!1)},initialize:function(){this.render(),i.EventBus.on("formatpopup:show",this.showPopUp,this),i.EventBus.on("formatpopup:hide",this.hidePopUp,this)},render:function(){return this.$el.append('<button class="popup-button villain-format-bold"><i class="fa fa-bold"></i></button>'),this.$el.append('<button class="popup-button villain-format-italic"><i class="fa fa-italic"></i></button>'),this.$el.append('<button class="popup-button villain-format-link"><i class="fa fa-link"></i></button>'),this.$el.append('<button class="popup-button villain-format-unlink"><i class="fa fa-unlink"></i></button>'),this},showPopUp:function(t){$el=t.$el;var a=window.getSelection(),i=a.getRangeAt(0),o=i.getBoundingClientRect(),n=$el.offset(),l={};mainContent=e("section#maincontent"),l.top=o.top+mainContent.scrollTop(),l.left=(o.left+o.right)/2-this.$el.width()/2-n.left+12,parseInt(l.left)<0&&(l.left="0"),l.left=l.left+"px",this.deactivateButtons(),this.activeButtons(),this.$el.addClass("show-popup"),this.$el.css(l)},hidePopUp:function(){console.log("hidePopUp"),this.$el.removeClass("show-popup")},activeButtons:function(){var t,e=window.getSelection();e.rangeCount>0&&(t=e.getRangeAt(0).startContainer.parentNode),t&&"A"==t.nodeName&&this.activateButton(".villain-format-link"),document.queryCommandState("bold")&&this.activateButton(".villain-format-bold"),document.queryCommandState("italic")&&this.activateButton(".villain-format-italic")},activateButton:function(t){this.$(t).addClass("active")},deactivateButtons:function(){this.$(".popup-button").removeClass("active")}}),i.Editor.HTML=i.Editor.HTML||{},i.Editor.EditorHTML=i.Editor.EditorHTML||{},i.toMD=function(t){return console.log(t),t=toMarkdown(t),t=t.replace(/&nbsp;/g," "),t=t.replace(/([^<>]+)(<div>)/g,"$1\n$2").replace(/<div><div>/g,"\n<div>").replace(/<div><br \/><\/div>/g,"\n\n").replace(/(?:<div>)([^<>]+)(?:<div>)/g,"$1\n").replace(/(?:<div>)(?:<br>)?([^<>]+)(?:<br>)?(?:<\/div>)/g,"$1\n").replace(/<\/p>/g,"\n\n").replace(/<(.)?br(.)?>/g,"\n").replace(/&lt;/g,"<").replace(/&gt;/g,">"),aggressiveStrip=!0,t=aggressiveStrip?t.replace(/<\/?[^>]+(>|$)/g,""):t.replace(/<(?=\S)\/?[^>]+(>|$)/gi,"")},i.toHTML=function(t,e){e=a.classify(e);var o=t,n="Text"===e;a.isUndefined(n)&&(n=!1),n&&(o="<div>"+o),o=o.replace(/\[([^\]]+)\]\(([^\)]+)\)/gm,function(t,e,a){return'<a href="'+a+'">'+e.replace(/\r?\n/g,"")+"</a>"}),o=a.reverse(a.reverse(o).replace(/_(?!\\)((_\\|[^_])*)_(?=$|[^\\])/gm,function(t,e){return">i/<"+e.replace(/\r?\n/g,"").replace(/[\s]+$/,"")+">i<"}).replace(/\*\*(?!\\)((\*\*\\|[^\*\*])*)\*\*(?=$|[^\\])/gm,function(t,e){return">b/<"+e.replace(/\r?\n/g,"").replace(/[\s]+$/,"")+">b<"})),o=o.replace(/^\> (.+)$/gm,"$1");var l,r;for(l in i.Formatters)i.Formatters.hasOwnProperty(l)&&(r=i.Formatters[l],!a.isUndefined(r.toHTML)&&a.isFunction(r.toHTML)&&(o=r.toHTML(o)));return n&&(o=o.replace(/\r?\n\r?\n/gm,"</div><div><br></div><div>"),o=o.replace(/\r?\n/gm,"</div><div>")),o=o.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\r?\n/g,"<br>").replace(/\*\*/,"").replace(/__/,""),o=o.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\-/g,"-"),n&&(o+="</div>"),o},i.browser=function(){var t={};if(this.getIEversion()>0)t.msie=!0;else{var e=navigator.userAgent.toLowerCase(),a=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],i={browser:a[1]||"",version:a[2]||"0"};a[1]&&(t[i.browser]=!0),parseInt(i.version,10)<9&&t.msie&&(t.oldMsie=!0),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0)}return t},i.Editor.processPaste=function(t){return t.match(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/gi)?(clean_html=i.Editor.wordClean(t),clean_html=i.Editor.clean(e("<div>").append(clean_html).html(),!1,!0),clean_html=i.Editor.removeEmptyTags(clean_html)):(clean_html=i.Editor.clean(t,!1,!0),clean_html=i.Editor.removeEmptyTags(clean_html)),clean_html=i.Editor.plainPasteClean(clean_html),""!==clean_html?clean_html:void(this.options.paragraphy&&this.wrapText(!0))},i.Editor.wordClean=function(t){t.indexOf("<body")>=0&&(t=t.replace(/[.\s\S\w\W<>]*<body[^>]*>([.\s\S\w\W<>]*)<\/body>[.\s\S\w\W<>]*/g,"$1")),t=t.replace(/<p(.*?)class="?'?MsoListParagraph"?'?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<ul><li><p>$3</p></li></ul>"),t=t.replace(/<p(.*?)class="?'?MsoListParagraphCxSpFirst"?'?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<ul><li><p>$3</p></li>"),t=t.replace(/<p(.*?)class="?'?MsoListParagraphCxSpMiddle"?'?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li><p>$3</p></li>"),t=t.replace(/<p(.*?)class="?'?MsoListParagraphCxSpLast"?'?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li><p>$3</p></li></ul>"),t=t.replace(/<span([^<]*?)style="?'?mso-list:Ignore"?'?([\s\S]*?)>([\s\S]*?)<span/gi,"<span><span"),t=t.replace(/<!--\[if \!supportLists\]-->([\s\S]*?)<!--\[endif\]-->/gi,""),t=t.replace(/(\n|\r| class=(")?Mso[a-zA-Z]+(")?)/gi," "),t=t.replace(/<!--[\s\S]*?-->/gi,""),t=t.replace(/<(\/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>/gi,"");for(var e=["style","script","applet","embed","noframes","noscript"],a=0;a<e.length;a++){var o=new RegExp("<"+e[a]+".*?"+e[a]+"(.*?)>","gi");t=t.replace(o,"")}t=t.replace(/([\w\-]*)=("[^<>"]*"|'[^<>']*'|\w+)/gi,""),t=t.replace(/&nbsp;/gi,"");var n;do n=t,t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"");while(t!=n);return t=i.Editor.clean(t)},i.Editor.clean=function(t,a,i,o,n){n=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","autosave","background","bgcolor","border","charset","cellpadding","cellspacing","checked","cite","class","color","cols","colspan","contenteditable","contextmenu","controls","coords","data","data-.*","datetime","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","icon","id","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","max","maxlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","span","src","srcdoc","srclang","srcset","start","step","summary","spellcheck","style","tabindex","target","title","type","translate","usemap","value","valign","width","wrap"],o=["!--","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","queue","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");var l=new RegExp("<\\/?((?!(?:"+o.join("|")+"))\\w+)[^>]*?>","gi");t=t.replace(l,"");var r=new RegExp("( (?!(?:"+n.join("|")+"))[a-zA-Z0-9-_]+)=((?:.(?!\\s+(?:\\S+)=|[>]|(\\/>)))+.)","gi");t=t.replace(r,"");var s=new RegExp("style=(\"[a-zA-Z0-9:;\\.\\s\\(\\)\\-\\,!\\/'%]*\"|'[a-zA-Z0-9:;\\.\\s\\(\\)\\-\\,!\\/\"%]*')","gi");t=t.replace(s,"");var c=e("<div>").append(t);return c.find('[class]:not([class^="fr-"])').each(function(t,a){e(a).removeAttr("class")}),t=c.html()},i.Editor.plainPasteClean=function(t){var a=e("<div>").html(t);a.find("h1, h2, h3, h4, h5, h6, pre, blockquote").each(function(t,a){e(a).replaceWith("<p>"+e(a).html()+"</p>")});for(var i=function(t,a){e(a).replaceWith(e(a).html())};a.find("strong, em, strike, b, u, i, sup, sub, span, a").length;)a.find("strong, em, strike, b, u, i, sup, sub, span, a").each(i);return a.html()},i.Editor.removeEmptyTags=function(t){for(var a,i=e("<div>").html(t),o=i.find("*:empty:not(br, img, td, th)");o.length;){for(a=0;a<o.length;a++)e(o[a]).remove();o=i.find("*:empty:not(br, img, td, th)")}i.find("> div").each(function(t,a){e(a).replaceWith(e(a).html()+"<br/>")});for(var n=i.find("div");n.length;){for(a=0;a<n.length;a++){var l=e(n[a]),r=l.html().replace(/\u0009/gi,"").trim();l.replaceWith(r)}n=i.find("div")}return i.html()},i.Editor.pasteHtmlAtCaret=function(t){var e,a;if(window.getSelection){if(e=window.getSelection(),e.getRangeAt&&e.rangeCount){a=e.getRangeAt(0),a.deleteContents();var i=document.createElement("div");i.innerHTML=t;for(var o,n,l=document.createDocumentFragment();o=i.firstChild;)n=l.appendChild(o);a.insertNode(l),n&&(a=a.cloneRange(),a.setStartAfter(n),a.collapse(!0),e.removeAllRanges(),e.addRange(a))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(t)},i.BlockRegistry={},i.BlockRegistry.Map={text:i.Blocks.Text,header:i.Blocks.Header,list:i.Blocks.List,image:i.Blocks.Image,video:i.Blocks.Video,divider:i.Blocks.Divider,columns:i.Blocks.Columns},i.BlockRegistry.getBlockClassByType=function(t){return i.BlockRegistry.Map.hasOwnProperty(t)?i.BlockRegistry.Map[t]:!1}}(jQuery,_);